{% extends "base.html" %}
{% block title %}Search form{% endblock %}
{% block content %}
  <div class="container-fluid px-lg-5 my-3">
    <h2>Search</h2>
    <form
      action="/search"
      method="POST">
      <div class="col-sm-6">
        <fieldset class="form-group">
          <legend style="font-size:20px" class="border-bottom mb-4">Genes</legend>
          <div class="form-group row">
            <label class="col-sm-3 col-form-label" for="gene-list">Gene identifier(s)</label>
            <div class="col-sm-9">
                <textarea class="form-control" id="gene-list" name="gene-list" placeholder="PBANKA_1414600
PBANKA_0206400
PBANKA_1451800
PBANKA_1339000
PBANKA_0106700
PBANKA_0408600
PBANKA_0617800">{% for gene_id in gene_ids %}{{ gene_id }}
{% endfor %}</textarea>
            </div>
          </div>
        </fieldset>
      </div>
      <div class="form-group">
        <button class="btn btn-primary mb-3">Submit</button>
      </div>
    </form>
  </div>
  {% if error %}
  <div class="container-fluid px-lg-5">
    <div class="alert alert-warning" role="alert">
        {{error}}
    </div>
  </div>
  {% else %}
    {% if output %}
      <hr/>
      <script id="accordion-list-view-template" type="x-tmpl-mustache">
        {% raw %}{{{paginationView}}}
        {{{listItems}}}
        {{{paginationView}}}{% endraw %}
      </script>
      <script id="accordion-annotation-template" type="x-tmpl-mustache">
        {% raw %}<span class="annotated-sequence break-all" data-annotation="{{ label }}">{{ sequence }}</span>{% endraw %}
      </script>
      <script id="accordion-row-template" type="x-tmpl-mustache">
        {% raw %}<div class="row my-lg-5 my-sm-2">
          <h3>{{ gene_id }}</h3>
          <div class="accordion" id="accordion-{{ index }}">
            <div class="accordion-item">
              <h4 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-annotated-{{ index }}" aria-expanded="true" aria-controls="collapse-annotated-{{ index }}">
                  Annotated sequence
                </button>
              </h4>
              <div id="collapse-annotated-{{ index }}" class="accordion-collapse collapse show" data-bs-parent="#accordion-{{ index }}">
                <div class="accordion-body">
                  <p>
                    {{{annotatedView}}}
                  </p>
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h4 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-sequence-{{ index }}" aria-expanded="true" aria-controls="collapse-sequence-{{ index }}">
                  Sequence only
                </button>
              </h4>
              <div id="collapse-sequence-{{ index }}" class="accordion-collapse collapse" data-bs-parent="#accordion-{{ index }}">
                <div class="accordion-body">
                  <p>
                    <span class="annotated-sequence break-all" data-annotation="Oligo sequence">{{ sequence }}</span>
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>{% endraw %}
      </script>
      <script id="table-list-view-template" type="x-tmpl-mustache">
        {% raw %}{{{paginationView}}}
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Gene ID</th>
              <th scope="col">Annotated Oligo Sequence</th>
            </tr>
          </thead>
          <tbody>
          {{{listItems}}}
          </tbody>
        </table>
        {{{paginationView}}}{% endraw %}
      </script>
      <script id="table-annotation-template" type="x-tmpl-mustache">
        {% raw %}<span class="annotated-sequence break-all" data-annotation="{{ label }}">{{ sequence }}</span>{% endraw %}
      </script>
      <script id="table-row-template" type="x-tmpl-mustache">
        {% raw %}<tr>
          <td>{{ gene_id }}</td>
          <td>{{{annotatedView}}}</td>
        </tr>{% endraw %}
      </script>
      <script id="pagination-item-template" type="x-tmpl-mustache">
        {% raw %}<li class="page-item {{disabled}}"><a class="page-link {{active}}" href="{{href}}">{{label}}</a></li>{% endraw %}
      </script>
      <script id="pagination-template" type="x-tmpl-mustache">
        {% raw %}<nav aria-label="Page navigation" class="my-3">
          <ul class="pagination justify-content-center">
            {{{paginationItems}}}
            <li class="page-item"><span class="pagination-label"> of {{pageCount}} pages.</span></li>
          </ul>
        </nav>{% endraw %}
      </script>
      <div class="container-fluid px-lg-5">
        <h2>Search results</h2>
        {% for file in files %}
        <a class="btn buttons-html5 btn-success" download="{{ file.name }}" href="{{ file.data }}">Download {{ file.type }}</a>
        {% endfor %}
        <div class="btn-group" role="group" aria-label="View type">
          <a class="btn btn-primary" href="#view=base"><i class="bi-view-stacked"></i></a>
          <a class="btn btn-primary" href="#view=table"><i class="bi-table"></i></a>
        </div>
      </div>
      <div class="container-fluid px-lg-5" id="item-view"></div>
      <script src="/static/vendor/mustache.js"></script>
      <script src="/static/render-items.js"></script>
      <script>
        const items = {% autoescape false %}{{ output }}{% endautoescape %};
        updatePageState()
        window.addEventListener("hashchange", updatePageState)
      </script>
    {% endif %}
  {% endif %}
{% endblock %}