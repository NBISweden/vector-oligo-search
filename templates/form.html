{% extends "base.html" %}
{% block title %}Search form{% endblock %}
{% block content %}
  <div class="container-fluid px-lg-5 my-3">
    <h2>Search</h2>
    <form
      action="/search"
      method="POST">
      <div class="col-sm-6">
        <fieldset class="form-group">
          <legend style="font-size:20px" class="border-bottom mb-4">Genes</legend>
          <!-- This is for gene ids   -->
          <div class="form-group row">
            <label class="col-sm-3 col-form-label" for="gene-id">Gene identifier</label>
              <div class="col-sm-9">
                <input class="form-control is-invalid ui-autocomplete-input" id="gene-id" name="gene-id" placeholder="PBANKA_XXXXXXX" type="text" value="">
                <datalist id="gene-id-list">
                  <option value="PBANKA_1034300"></option>
                  <option value="PBANKA_1231600"></option>
                  <option value="PBANKA_1437500"></option>
                  <option value="PBANKA_1015500"></option>
                  <option value="PBANKA_1319700"></option>
                </datalist>
              </div>
          </div>

          <!-- This is for gene list   -->

          <div class="form-group row">
            <label class="col-sm-3 col-form-label" for="gene-list">Gene identifier(s)</label>
            <div class="col-sm-9">
                <textarea class="form-control is-invalid" id="gene-list" name="gene-list" placeholder="PBANKA_1465921
PBANKA_000050
PBANKA_1466100">{% for gene_id in gene_ids %}{{ gene_id }}
{% endfor %}</textarea>
            </div>
          </div>
        </fieldset>
      </div>
      <div class="form-group">
        <button class="btn btn-primary mb-3">Submit</button>
      </div>
    </form>
  </div>
  {% if error %}
  <div class="container-fluid px-lg-5">
    <div class="alert alert-warning" role="alert">
        {{error}}
    </div>
  </div>
  {% else %}
    {% if output %}
      <div class="container-fluid px-lg-5">
      {% for entry in output %}
        <div class="row my-lg-5 my-sm-2">
          <h2>{{ entry.gene_id }}</h2>
          <div class="accordion" id="accordion-{{ loop.index }}">
            <div class="accordion-item">
              <h3 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-annotated-{{ loop.index }}" aria-expanded="true" aria-controls="collapse-annotated-{{ loop.index }}">
                  Annotated sequence
                </button>
              </h3>
              <div id="collapse-annotated-{{ loop.index }}" class="accordion-collapse collapse show" data-bs-parent="#accordion-{{ loop.index }}">
                <div class="accordion-body">
                  <p>
                  {% for annotation in entry.annotations %}<span class="annotated-sequence break-all" data-annotation="{{ annotation.label }}">{{ entry.sequence[annotation.position[0]:annotation.position[1]] }}</span>{% endfor %}
                  </p>
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h3 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-sequence-{{ loop.index }}" aria-expanded="true" aria-controls="collapse-sequence-{{ loop.index }}">
                  Sequence only
                </button>
              </h3>
              <div id="collapse-sequence-{{ loop.index }}" class="accordion-collapse collapse" data-bs-parent="#accordion-{{ loop.index }}">
                <div class="accordion-body">
                  <p>
                    <span class="annotated-sequence break-all" data-annotation="Oligo sequence">{{ entry.sequence }}</span>
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
      </div>
    {% endif %}
  {% endif %}
{% endblock %}